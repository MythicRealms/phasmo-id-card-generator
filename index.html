<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phasmo ID Card Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas CDN for image download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Base styles for full height and no default margins/padding */
        html, body, #root {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: auto; /* Allow scrolling on the main page if content exceeds viewport */
            font-family: 'Inter', sans-serif; /* Apply Inter font globally */
        }

        /* Custom scrollbar for better aesthetics */
        body::-webkit-scrollbar {
            width: 8px;
        }
        body::-webkit-scrollbar-track {
            background: #2d3748; /* bg-gray-800 */
        }
        body::-webkit-scrollbar-thumb {
            background-color: #e53e3e; /* bg-red-600 */
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Explicitly define React and ReactDOM from the global window object
        const React = window.React;
        const ReactDOM = window.ReactDOM;

        const { useState, useRef, useEffect } = React;

        // Function to convert a number to a Roman numeral
        const toRoman = (num) => {
            if (typeof num !== 'number' || !Number.isInteger(num) || num < 1 || num > 3999) {
                return String(num); // Return as string if invalid or not an integer
            }

            const romanMap = [
                { value: 1000, numeral: 'M' },
                { value: 900, numeral: 'CM' },
                { value: 500, numeral: 'D' },
                { value: 400, numeral: 'CD' },
                { value: 100, numeral: 'C' },
                { value: 90, numeral: 'XC' },
                { value: 50, numeral: 'L' },
                { value: 40, numeral: 'XL' },
                { value: 10, numeral: 'X' },
                { value: 9, numeral: 'IX' },
                { value: 5, numeral: 'V' },
                { value: 4, numeral: 'IV' },
                { value: 1, numeral: 'I' },
            ];

            let result = '';
            for (const { value, numeral } of romanMap) {
                while (num >= value) {
                    result += numeral;
                    num -= value;
                }
            }
            return result;
        };

        // Helper function to resize images (PNG/JPEG)
        const resizeImage = (file, maxWidth, maxHeight, quality) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        let width = img.width;
                        let height = img.height;

                        // Calculate new dimensions to fit within maxWidth/maxHeight
                        if (width > height) {
                            if (width > maxWidth) {
                                height = Math.round(height * (maxWidth / width));
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width = Math.round(width * (maxHeight / height));
                                height = maxHeight;
                            }
                        }

                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // Convert canvas to data URL with specified quality for JPEG
                        // PNG does not use quality parameter, but it's harmless
                        resolve(canvas.toDataURL(file.type, quality));
                    };
                    img.onerror = () => {
                        console.error("Error loading image for resizing.");
                        resolve(event.target.result); // Resolve with original if error
                    };
                };
                reader.onerror = () => {
                    console.error("Error reading file for resizing.");
                    resolve(null); // Resolve with null if error
                };
            });
        };


        const App = () => {
            // Default placeholder image for the profile
            const DEFAULT_PROFILE_IMAGE = 'https://placehold.co/250x350/000000/FFFFFF?text=Upload+Image';
            // Default background style for the ID card
            const DEFAULT_BACKGROUND_STYLE = {
                // Using a simpler, more html2canvas-friendly background pattern as default
                // This is a small SVG data URL that creates a subtle grid/dot pattern
                backgroundImage: 'url("data:image/svg+xml,%3Csvg width=\'6\' height=\'6\' viewBox=\'0 0 6 6\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'%239C92AC\' fill-opacity=\'0.1\' fill-rule=\'evenodd\'%3E%3Cpath d=\'M5 0h1L0 6V5zM6 5v1H5z\'/%3E%3C/g%3E%3C/svg%3E")',
                backgroundSize: 'cover', // Cover the entire area
                backgroundPosition: 'center', // Center the background
                backgroundRepeat: 'no-repeat', // Don't repeat the background image
                backgroundColor: '#2D3748', // Fallback solid color for the background
                boxShadow: 'inset 0 0 50px rgba(0,0,0,0.5)' // Inner shadow for depth
            };

            // State variables for ID card details
            const [agentName, setAgentName] = useState('Player');
            const [rank, setRank] = useState('PARANORMAL INVESTIGATOR');
            const [prestige, setPrestige] = useState(1);
            const [actualLevel, setActualLevel] = useState(0); // Changed default to 0
            // New states for the dynamic input fields
            const [selectedCategory, setSelectedCategory] = useState('equipment'); // 'equipment', 'specialization', 'teamName'
            const [selectedEquipment, setSelectedEquipment] = useState(['Spirit Box', 'EMF Reader', 'Flashlight']); // Max 3
            const [selectedSpecialization, setSelectedSpecialization] = useState('Ghost Type Identification');
            const [teamNameInput, setTeamNameInput] = useState('Ghost Hunters Inc.');
            const [headgear, setHeadgear] = useState(''); // State for optional Headgear (now controlled by radio buttons)

            const [profileImage, setProfileImage] = useState(DEFAULT_PROFILE_IMAGE); // Use the default placeholder
            const [backgroundStyle, setBackgroundStyle] = useState(DEFAULT_BACKGROUND_STYLE); // State for background style

            // States for custom badge data URLs (can be raster image data URL)
            // NEW: Default PNG images for badges
            const [customBadge1DataUrl, setCustomBadge1DataUrl] = useState('https://i.ibb.co/KkZ9Nv3/1.png');
            const [customBadge2DataUrl, setCustomBadge2DataUrl] = useState('https://i.ibb.co/C3zZMv0s/2.png');

            // New state variables for custom colors
            const [accentColor, setAccentColor] = useState('#EF4444'); // Default Tailwind red-500
            const [labelColor, setLabelColor] = useState('#F3F4F6'); // Default Tailwind gray-100

            const idCardRef = useRef(null);
            const fileInputRef = useRef(null); // Ref for the file input to clear it
            const backgroundFileInputRef = useRef(null); // Ref for background file input
            const badge1FileInputRef = useRef(null); // Ref for badge 1 file input
            const badge2FileInputRef = useRef(null); // Ref for badge 2 file input


            // Data lists for dropdowns and checkboxes
            const EQUIPMENT_LIST = [
                'Spirit Box', 'EMF Reader', 'Flashlight', 'UV Light', 'Video Camera',
                'Photo Camera', 'Tripod', 'Ghost Writing Book', 'Salt', 'Incense',
                'Firelight',
                'Motion Sensor', 'Sound Sensor', 'Thermometer',
                'Sanity Pills', 'DOTS Projector',
                'Parabolic Microphone', 'Sound Recorder'
            ];

            const SPECIALIZATION_LIST = [
                'Ghost Type Identification', 'Evidence Collector', 'Sanity Manager',
                'Paranormal Photography', 'Spirit Box Expert', 'EMF Specialist',
                'Thermals Expert', 'Cursed Objects Finder', 'Team Leader', 'Support'
            ];

            const HEADGEAR_OPTIONS = ['Camera', 'Flashlight', 'Nightvision']; // Headgear options

            const handleImageUpload = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.type.startsWith('image/')) {
                        const resizedDataUrl = await resizeImage(file, 350, 350, 0.8); // Max 350px for profile
                        if (resizedDataUrl) {
                            setProfileImage(resizedDataUrl);
                        } else {
                            alert("Failed to process image. Please try another file.");
                            if (fileInputRef.current) fileInputRef.current.value = '';
                        }
                    } else {
                        alert("Please upload a valid image file (PNG, JPEG, GIF, etc.) for Profile Image.");
                        if (fileInputRef.current) fileInputRef.current.value = '';
                    }
                }
            };

            // Function to clear the profile image and reset the file input
            const clearProfileImage = () => {
                setProfileImage(DEFAULT_PROFILE_IMAGE);
                if (fileInputRef.current) {
                    fileInputRef.current.value = ''; // Clear the selected file
                }
            };

            // Handle background image upload
            const handleBackgroundUpload = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.type.startsWith('image/')) {
                        const resizedDataUrl = await resizeImage(file, 1000, 553, 0.7); // Max 1000x553 for background
                        if (resizedDataUrl) {
                            setBackgroundStyle({
                                backgroundImage: `url(${resizedDataUrl})`,
                                backgroundSize: 'cover',
                                backgroundPosition: 'center',
                                backgroundRepeat: 'no-repeat',
                                backgroundColor: 'transparent', // Ensure no background color interferes
                                boxShadow: 'inset 0 0 50px rgba(0,0,0,0.5)'
                            });
                        } else {
                            alert("Failed to process background image. Please try another file.");
                            if (backgroundFileInputRef.current) backgroundFileInputRef.current.value = '';
                        }
                    } else {
                        alert("Please upload a valid image file (PNG, JPEG, GIF, etc.) for Background.");
                        if (backgroundFileInputRef.current) backgroundFileInputRef.current.value = '';
                    }
                }
            };

            // Function to clear the background image and revert to default gradient
            const clearBackground = () => {
                setBackgroundStyle(DEFAULT_BACKGROUND_STYLE); // Revert to the default background style
                if (backgroundFileInputRef.current) {
                    backgroundFileInputRef.current.value = ''; // Clear the selected file
                }
            };

            // Removed processSvgForBadge function as SVG support is removed

            // Handle custom badge 1 upload (now only PNG/JPEG)
            const handleBadge1Upload = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.type.startsWith('image/png') || file.type.startsWith('image/jpeg')) {
                        const resizedDataUrl = await resizeImage(file, 100, 100, 0.9); // Max 100px for badges
                        if (resizedDataUrl) {
                            setCustomBadge1DataUrl(resizedDataUrl);
                        } else {
                            alert("Failed to process image for Badge 1. Please try another file.");
                            if (badge1FileInputRef.current) badge1FileInputRef.current.value = '';
                        }
                    } else {
                        alert('Please upload a valid PNG or JPEG file for Badge 1.');
                        if (event.target) event.target.value = ''; // Clear file input
                    }
                }
            };

            // Handle custom badge 2 upload (now only PNG/JPEG)
            const handleBadge2Upload = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.type.startsWith('image/png') || file.type.startsWith('image/jpeg')) {
                        const resizedDataUrl = await resizeImage(file, 100, 100, 0.9); // Max 100px for badges
                        if (resizedDataUrl) {
                            setCustomBadge2DataUrl(resizedDataUrl);
                        } else {
                            alert("Failed to process image for Badge 2. Please try another file.");
                            if (badge2FileInputRef.current) badge2FileInputRef.current.value = '';
                        }
                    } else {
                        alert('Please upload a valid PNG or JPEG file for Badge 2.');
                        if (event.target) event.target.value = ''; // Clear file input
                    }
                }
            };

            // Function to clear custom badge 1
            const clearBadge1 = () => {
                setCustomBadge1DataUrl('https://i.ibb.co/KkZ9Nv3/1.png'); // Revert to default
                if (badge1FileInputRef.current) {
                    badge1FileInputRef.current.value = '';
                }
            };

            // Function to clear custom badge 2
            const clearBadge2 = () => {
                setCustomBadge2DataUrl('https://i.ibb.co/C3zZMv0s/2.png'); // Revert to default
                if (badge2FileInputRef.current) {
                    badge2FileInputRef.current.value = '';
                }
            };

            // Handle equipment checkbox changes (max 3)
            const handleEquipmentChange = (e) => {
                const value = e.target.value;
                const isChecked = e.target.checked;

                setSelectedEquipment(prev => {
                    if (isChecked) {
                        if (prev.length < 3) {
                            return [...prev, value];
                        } else {
                            // If already 3, prevent checking more
                            e.target.checked = false; // Uncheck the box if limit reached
                            return prev;
                        }
                    } else {
                        return prev.filter(item => item !== value);
                    }
                });
            };

            const downloadIdCard = () => {
                if (idCardRef.current) {
                    if (window.html2canvas) {
                        window.html2canvas(idCardRef.current, {
                            scale: 2,
                            useCORS: true,
                            logging: true,
                        }).then(canvas => {
                            const link = document.createElement('a');
                            link.download = 'phasmo-id-card.png';
                            link.href = canvas.toDataURL('image/png');
                            link.click();
                        }).catch(error => {
                            console.error("Error generating ID card image:", error);
                            alert("Failed to generate ID card image. Please try again.");
                        });
                    } else {
                        console.error("html2canvas is not loaded. Cannot download ID card.");
                        alert("Image download feature is not ready. Please try again in a moment.");
                    }
                }
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-100 p-4 flex flex-col items-center justify-center gap-8 w-full">
                    {/* Input Form Section - Horizontal Bar at the Top */}
                    <div className="w-full bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8">
                        <h1 className="text-3xl font-bold" style={{ color: accentColor }}>Create Your Phasmo ID</h1>

                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                            <div className="min-w-0">
                                <label htmlFor="agentName" className="block text-sm font-medium text-gray-300 mb-1">Agent Name</label>
                                <input type="text" id="agentName" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={agentName} onChange={(e) => setAgentName(e.target.value)} placeholder="e.g., John Doe" />
                            </div>
                            <div className="min-w-0">
                                <label htmlFor="rank" className="block text-sm font-medium text-gray-300 mb-1">Main Title</label>
                                <input type="text" id="rank" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={rank} onChange={(e) => setRank(e.target.value)} placeholder="e.g., Investigator" />
                            </div>
                            <div className="min-w-0">
                                <label htmlFor="prestige" className="block text-sm font-medium text-gray-300 mb-1">Prestige</label>
                                <input type="number" id="prestige" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={prestige} onChange={(e) => setPrestige(parseInt(e.target.value) || 0)} placeholder="e.g., 1" min="0" />
                            </div>
                            <div className="min-w-0">
                                <label htmlFor="actualLevel" className="block text-sm font-medium text-gray-300 mb-1">Level</label>
                                <input type="number" id="actualLevel" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={actualLevel} onChange={(e) => setActualLevel(parseInt(e.target.value) || 0)} placeholder="e.g., 97" min="0" />
                            </div>

                            {/* New Category Selection Dropdown */}
                            <div className="min-w-0 col-span-full sm:col-span-2 md:col-span-3 lg:col-span-1">
                                <label htmlFor="categorySelect" className="block text-sm font-medium text-gray-300 mb-1">Choose Detail Type</label>
                                <select
                                    id="categorySelect"
                                    className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white"
                                    value={selectedCategory}
                                    onChange={(e) => setSelectedCategory(e.target.value)}
                                >
                                    <option value="equipment">Preferred Gear</option>
                                    <option value="specialization">Specialization</option>
                                    <option value="teamName">Team Name</option>
                                </select>
                            </div>

                            {/* Conditional Input Fields - Reverted centering changes */}
                            {selectedCategory === 'equipment' && (
                                <div className="min-w-0 col-span-full">
                                    <label className="block text-sm font-medium text-gray-300 mb-2">Select Preferred Gear (Max 3)</label>
                                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 max-h-48 overflow-y-auto p-2 rounded-lg bg-gray-700 border border-gray-600 w-full">
                                        {EQUIPMENT_LIST.map(item => (
                                            <div key={item} className="flex items-center">
                                                <input
                                                    type="checkbox"
                                                    id={`gear-${item}`}
                                                    value={item}
                                                    checked={selectedEquipment.includes(item)}
                                                    onChange={handleEquipmentChange}
                                                    className="form-checkbox h-4 w-4 text-red-600 transition duration-150 ease-in-out rounded-md border-gray-500 bg-gray-800"
                                                />
                                                <label htmlFor={`gear-${item}`} className="ml-2 text-sm text-gray-300">{item}</label>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {selectedCategory === 'specialization' && (
                                <div className="min-w-0 col-span-full">
                                    <label htmlFor="specializationSelect" className="block text-sm font-medium text-gray-300 mb-1">Select Specialization</label>
                                    <select
                                        id="specializationSelect"
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white"
                                        value={selectedSpecialization}
                                        onChange={(e) => setSelectedSpecialization(e.target.value)}
                                    >
                                        {SPECIALIZATION_LIST.map(item => (
                                            <option key={item} value={item}>{item}</option>
                                        ))}
                                    </select>
                                </div>
                            )}

                            {selectedCategory === 'teamName' && (
                                <div className="min-w-0 col-span-full">
                                    <label htmlFor="teamNameInput" className="block text-sm font-medium text-gray-300 mb-1">Team Name</label>
                                    <input
                                        type="text"
                                        id="teamNameInput"
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400"
                                        value={teamNameInput}
                                        onChange={(e) => setTeamNameInput(e.target.value)}
                                        placeholder="e.g., Ghost Hunters"
                                    />
                                </div>
                            )}

                            {/* Headgear Radio Buttons */}
                            <div className="min-w-0 col-span-full">
                                <label className="block text-sm font-medium text-gray-300 mb-2">Optional Headgear</label>
                                <div className="flex flex-wrap gap-4 p-2 rounded-lg bg-gray-700 border border-gray-600">
                                    {HEADGEAR_OPTIONS.map(option => (
                                        <div key={option} className="flex items-center">
                                            <input
                                                type="radio"
                                                id={`headgear-${option}`}
                                                name="headgear"
                                                value={option}
                                                checked={headgear === option}
                                                onChange={(e) => setHeadgear(e.target.value)}
                                                className="form-radio h-4 w-4 text-red-600 transition duration-150 ease-in-out rounded-full border-gray-500 bg-gray-800"
                                            />
                                            <label htmlFor={`headgear-${option}`} className="ml-2 text-sm text-gray-300">{option}</label>
                                        </div>
                                    ))}
                                    {/* Option to clear headgear selection */}
                                    <div className="flex items-center">
                                        <input
                                            type="radio"
                                            id="headgear-none"
                                            name="headgear"
                                            value=""
                                            checked={headgear === ''}
                                            onChange={(e) => setHeadgear('')}
                                            className="form-radio h-4 w-4 text-gray-400 transition duration-150 ease-in-out rounded-full border-gray-500 bg-gray-800"
                                        />
                                        <label htmlFor="headgear-none" className="ml-2 text-sm text-gray-300">None</label>
                                    </div>
                                </div>
                            </div>


                            {/* Container for Profile Image and Background Image sections to be on the same row */}
                            <div className="col-span-full grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* Image Upload and Clear Button for Profile Photo */}
                                <div className="min-w-0">
                                    <label htmlFor="profileImageUpload" className="block text-sm font-medium text-gray-300 mb-1">Upload Profile Image (PNG, JPEG, GIF)</label>
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearProfileImage}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Photo
                                        </button>
                                        <input
                                            type="file"
                                            id="profileImageUpload"
                                            accept="image/png, image/jpeg, image/gif"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleImageUpload}
                                            ref={fileInputRef} // Attach ref here
                                        />
                                    </div>
                                </div>

                                {/* Image Upload and Clear Button for Background */}
                                <div className="min-w-0">
                                    <label htmlFor="backgroundUpload" className="block text-sm font-medium text-gray-300 mb-1">Choose Background (PNG, JPEG, GIF)</label>
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearBackground}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Background
                                        </button>
                                        <input
                                            type="file"
                                            id="backgroundUpload"
                                            accept="image/png, image/jpeg, image/gif"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleBackgroundUpload}
                                            ref={backgroundFileInputRef} // Attach ref here
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Custom Badge Uploads Section - Now with 2 badges */}
                            <div className="col-span-full grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* Custom Badge 1 Upload */}
                                <div className="min-w-0">
                                    <label htmlFor="badge1Upload" className="block text-sm font-medium text-gray-300 mb-1">Upload Badge 1 (PNG, JPEG)</label>
                                    {/* Removed SVG conversion link */}
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearBadge1}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Badge 1
                                        </button>
                                        <input
                                            type="file"
                                            id="badge1Upload"
                                            accept="image/png, image/jpeg"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleBadge1Upload}
                                            ref={badge1FileInputRef}
                                        />
                                    </div>
                                </div>

                                {/* Custom Badge 2 Upload */}
                                <div className="min-w-0">
                                    <label htmlFor="badge2Upload" className="block text-sm font-medium text-gray-300 mb-1">Upload Badge 2 (PNG, JPEG)</label>
                                    {/* Removed SVG conversion link */}
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearBadge2}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Badge 2
                                        </button>
                                        <input
                                            type="file"
                                            id="badge2Upload"
                                            accept="image/png, image/jpeg"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleBadge2Upload}
                                            ref={badge2FileInputRef}
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* New Color Pickers */}
                            <div className="col-span-full grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="min-w-0">
                                    <label htmlFor="accentColor" className="block text-sm font-medium text-gray-300 mb-1">Accent Color (Text & Border)</label>
                                    <input
                                        type="color"
                                        id="accentColor"
                                        className="w-full h-10 p-1 border border-gray-600 rounded-lg cursor-pointer"
                                        value={accentColor}
                                        onChange={(e) => setAccentColor(e.target.value)}
                                    />
                                </div>
                                <div className="min-w-0">
                                    <label htmlFor="labelColor" className="block text-sm font-medium text-gray-300 mb-1">Label Color (NAME, LEVEL, etc.)</label>
                                    <input
                                        type="color"
                                        id="labelColor"
                                        className="w-full h-10 p-1 border border-gray-600 rounded-lg cursor-pointer"
                                        value={labelColor}
                                        onChange={(e) => setLabelColor(e.target.value)}
                                    />
                                </div>
                            </div>


                            <div className="col-span-full min-w-0">
                                <button onClick={downloadIdCard} className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105" style={{ backgroundColor: accentColor }}>
                                    Download ID Card
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* ID Card Display Section - centered below the form */}
                    <div className="flex-shrink-0 mx-auto w-full flex justify-center">
                        <div
                            ref={idCardRef}
                            className="relative rounded-xl shadow-2xl overflow-hidden border-2"
                            style={{
                                width: 'min(100%, 1000px)', /* Responsive width, max 1000px */
                                minWidth: '500px', /* Minimum width for visibility */
                                aspectRatio: '1000 / 553', /* Maintain aspect ratio */
                                ...backgroundStyle, /* Apply dynamic background style */
                                borderColor: accentColor /* Apply accent color to border */
                            }}
                        >
                            {/* Top Header: PARANORMAL INVESTIGATOR */}
                            <div className="absolute top-0 left-0 right-0 text-white text-center py-4 px-6 rounded-t-xl" style={{ height: '70px', backgroundColor: accentColor }}>
                                <h2 className="text-4xl font-extrabold uppercase tracking-widest leading-none" style={{ textShadow: '2px 2px 4px rgba(0,0,0,0.5)' }}>
                                    {rank}
                                </h2>
                            </div>

                            {/* Main Content Area - Now using CSS Grid for layout */}
                            <div className="absolute top-[70px] left-0 right-0 bottom-0 grid"
                                style={{
                                    gridTemplateColumns: '250px 1.5fr 224px', /* Increased space for text, fixed profile, fixed badges */
                                    padding: '32px', /* Equivalent to p-8 */
                                    gap: '32px' /* Equivalent to gap-8 */
                                }}>
                                {/* Column 1: Profile Image */}
                                <div className="flex flex-col items-start justify-start"> {/* Align to top-left of its grid cell */}
                                    {/* Profile Image Container - Now using background-image for better html2canvas rendering */}
                                    <div className="w-[250px] h-[350px] rounded-xl overflow-hidden border-4 border-gray-400 bg-gray-600 shadow-lg"
                                        style={{
                                            borderRadius: '15px',
                                            backgroundImage: `url(${profileImage})`,
                                            backgroundSize: 'cover',
                                            backgroundPosition: 'center',
                                            backgroundRepeat: 'no-repeat'
                                        }}>
                                        {/* No img tag needed here anymore */}
                                    </div>
                                </div>

                                {/* Column 2: Name, Level, and Dynamic Text Fields */}
                                <div className="flex flex-col justify-start items-start"> {/* Align to top-left of its grid cell */}
                                    <p className="text-xl font-bold uppercase mb-1" style={{ color: labelColor }}>NAME</p>
                                    <h3 className="text-6xl font-extrabold uppercase tracking-wide leading-tight" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor }}>
                                        {agentName}
                                    </h3>
                                    <p className="text-xl font-bold uppercase mt-4 mb-1" style={{ color: labelColor }}>LEVEL</p>
                                    <h3 className="text-5xl font-extrabold uppercase tracking-wide leading-tight" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor }}>
                                        {`${toRoman(prestige)}-${actualLevel.toString().padStart(2, '0')}`}
                                    </h3>

                                    {/* Dynamic section for Preferred Gear, Specialization, or Team Name */}
                                    <div className="mt-8 space-y-4 w-full"> {/* Increased space-y for better vertical separation */}
                                        {selectedCategory === 'equipment' && (
                                            <p className="flex flex-col items-start"> {/* Use flex-col to stack label and content */}
                                                <span className="text-xl font-bold uppercase mr-2" style={{ color: labelColor }}>Preferred Gear:</span>
                                                <span className="text-2xl font-extrabold uppercase tracking-wide leading-tight w-full" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor, wordWrap: 'break-word', whiteSpace: 'normal' }}>
                                                    {selectedEquipment.join(', ')}
                                                </span>
                                            </p>
                                        )}
                                        {selectedCategory === 'specialization' && (
                                            <p className="flex flex-col items-start"> {/* Use flex-col to stack label and content */}
                                                <span className="text-xl font-bold uppercase mr-2" style={{ color: labelColor }}>Specialization:</span>
                                                <span className="text-2xl font-extrabold uppercase tracking-wide leading-tight w-full" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor, wordWrap: 'break-word', whiteSpace: 'normal' }}>
                                                    {selectedSpecialization}
                                                </span>
                                            </p>
                                        )}
                                        {selectedCategory === 'teamName' && (
                                            <p className="flex flex-col items-start"> {/* Use flex-col to stack label and content */}
                                                <span className="text-xl font-bold uppercase mr-2" style={{ color: labelColor }}>Team Name:</span>
                                                <span className="text-2xl font-extrabold uppercase tracking-wide leading-tight w-full" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor, wordWrap: 'break-word', whiteSpace: 'normal' }}>
                                                    {teamNameInput}
                                                </span>
                                            </p>
                                        )}
                                        {/* Optional Headgear Display */}
                                        {headgear && (
                                            <p className="flex flex-col items-start">
                                                <span className="text-xl font-bold uppercase mr-2" style={{ color: labelColor }}>Headgear:</span>
                                                <span className="text-2xl font-extrabold uppercase tracking-wide leading-tight w-full" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor, wordWrap: 'break-word', whiteSpace: 'normal' }}>
                                                    {headgear}
                                                </span>
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* Column 3: Badges */}
                                <div className="flex flex-row items-center justify-center gap-8"> {/* Changed to flex-row for horizontal stacking, centered */}
                                    {/* Badge 1 */}
                                    <div className="w-28 h-28 rounded-full flex items-center justify-center shadow-xl overflow-hidden flex-shrink-0"
                                        style={{
                                            width: '112px', /* Explicitly set width */
                                            height: '112px', /* Explicitly set height */
                                            borderRadius: '50%', /* Explicitly set border-radius to ensure perfect circle */
                                            backgroundColor: 'rgba(255,255,255,0.1)',
                                            backgroundImage: `url(${customBadge1DataUrl})`, // Always use background-image for consistency
                                            backgroundSize: 'cover',
                                            backgroundPosition: 'center',
                                            backgroundRepeat: 'no-repeat'
                                        }}>
                                        {/* No img tag or SVG rendering needed here as background-image is used */}
                                    </div>

                                    {/* Badge 2 */}
                                    <div className="w-28 h-28 rounded-full flex items-center justify-center shadow-xl overflow-hidden flex-shrink-0"
                                        style={{
                                            width: '112px', /* Explicitly set width */
                                            height: '112px', /* Explicitly set height */
                                            borderRadius: '50%', /* Explicitly set border-radius to ensure perfect circle */
                                            backgroundColor: 'rgba(255,255,255,0.1)',
                                            backgroundImage: `url(${customBadge2DataUrl})`, // Always use background-image for consistency
                                            backgroundSize: 'cover',
                                            backgroundPosition: 'center',
                                            backgroundRepeat: 'no-repeat'
                                        }}>
                                        {/* No img tag or SVG rendering needed here as background-image is used */}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
