<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phasmo ID Card Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas CDN for image download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Base styles for full height and no default margins/padding */
        html, body, #root {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: auto; /* Allow scrolling on the main page if content exceeds viewport */
            font-family: 'Inter', sans-serif; /* Apply Inter font globally */
        }

        /* Custom scrollbar for better aesthetics */
        body::-webkit-scrollbar {
            width: 8px;
        }
        body::-webkit-scrollbar-track {
            background: #2d3748; /* bg-gray-800 */
        }
        body::-webkit-scrollbar-thumb {
            background-color: #e53e3e; /* bg-red-600 */
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Explicitly define React and ReactDOM from the global window object
        const React = window.React;
        const ReactDOM = window.ReactDOM;

        const { useState, useRef, useEffect } = React;

        // Function to convert a number to a Roman numeral
        const toRoman = (num) => {
            if (typeof num !== 'number' || !Number.isInteger(num) || num < 1 || num > 3999) {
                return String(num); // Return as string if invalid or not an integer
            }

            const romanMap = [
                { value: 1000, numeral: 'M' },
                { value: 900, numeral: 'CM' },
                { value: 500, numeral: 'D' },
                { value: 400, numeral: 'CD' },
                { value: 100, numeral: 'C' },
                { value: 90, numeral: 'XC' },
                { value: 50, numeral: 'L' },
                { value: 40, numeral: 'XL' },
                { value: 10, numeral: 'X' },
                { value: 9, numeral: 'IX' },
                { value: 5, numeral: 'V' },
                { value: 4, numeral: 'IV' },
                { value: 1, numeral: 'I' },
            ];

            let result = '';
            for (const { value, numeral } of romanMap) {
                while (num >= value) {
                    result += numeral;
                    num -= value;
                }
            }
            return result;
        };

        const App = () => {
            // Default placeholder image for the profile
            const DEFAULT_PROFILE_IMAGE = 'https://placehold.co/250x350/000000/FFFFFF?text=Upload+Image';
            // Default background style for the ID card
            const DEFAULT_BACKGROUND_STYLE = {
                backgroundImage: 'url("data:image/svg+xml,%3Csvg width=\'6\' height=\'6\' viewBox=\'0 0 6 6\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'%239C92AC\' fill-opacity=\'0.1\' fill-rule=\'evenodd\'%3E%3Cpath d=\'M5 0h1L0 6V5zM6 5v1H5z\'/%3E%3C/g%3E%3C/svg%3E")',
                backgroundSize: 'cover',
                backgroundPosition: 'center',
                backgroundRepeat: 'no-repeat',
                backgroundColor: 'transparent', // Ensure no background color interferes
                boxShadow: 'inset 0 0 50px rgba(0,0,0,0.5)'
            };
            const DEFAULT_GRADIENT_BACKGROUND = 'linear-gradient(145deg, #4A00B0, #004080, #300060)'; // A default gradient for clarity

            // State variables for ID card details
            const [agentName, setAgentName] = useState('HAMMOND');
            const [rank, setRank] = useState('PARANORMAL INVESTIGATOR');
            const [prestige, setPrestige] = useState(1);
            const [actualLevel, setActualLevel] = useState(97);

            // New states for the dynamic input fields
            const [selectedCategory, setSelectedCategory] = useState('equipment'); // 'equipment', 'specialization', 'teamName'
            const [selectedEquipment, setSelectedEquipment] = useState(['Spirit Box', 'EMF Reader', 'Flashlight']); // Max 3
            const [selectedSpecialization, setSelectedSpecialization] = useState('Ghost Type Identification');
            const [teamNameInput, setTeamNameInput] = useState('Ghost Hunters Inc.');

            const [profileImage, setProfileImage] = useState(DEFAULT_PROFILE_IMAGE); // Use the default placeholder
            const [backgroundStyle, setBackgroundStyle] = useState(DEFAULT_BACKGROUND_STYLE); // State for background style

            // States for custom SVG badges
            const [customBadge1Svg, setCustomBadge1Svg] = useState(null);
            const [customBadge2Svg, setCustomBadge2Svg] = useState(null);

            // New state variables for custom colors
            const [accentColor, setAccentColor] = useState('#EF4444'); // Default Tailwind red-500
            const [labelColor, setLabelColor] = useState('#F3F4F6'); // Default Tailwind gray-100

            const idCardRef = useRef(null);
            const fileInputRef = useRef(null); // Ref for the file input to clear it
            const backgroundFileInputRef = useRef(null); // Ref for background file input
            const badge1FileInputRef = useRef(null); // Ref for badge 1 file input
            const badge2FileInputRef = useRef(null); // Ref for badge 2 file input


            // Data lists for dropdowns and checkboxes
            const EQUIPMENT_LIST = [
                'Spirit Box', 'EMF Reader', 'Flashlight', 'UV Light', 'Video Camera',
                'Photo Camera', 'Tripod', 'Ghost Writing Book', 'Salt', 'Smudge Sticks',
                'Lighter', 'Candle', 'Crucifix', 'Motion Sensor', 'Sound Sensor',
                'Thermomenter', 'Head Mounted Camera', 'Sanity Pills', 'DOTS Projector',
                'Igniter'
            ];

            const SPECIALIZATION_LIST = [
                'Ghost Type Identification', 'Evidence Collector', 'Sanity Manager',
                'Paranormal Photography', 'Spirit Box Expert', 'EMF Specialist',
                'Thermals Expert', 'Cursed Objects Finder', 'Team Leader', 'Support'
            ];

            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setProfileImage(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Function to clear the profile image and reset the file input
            const clearProfileImage = () => {
                setProfileImage(DEFAULT_PROFILE_IMAGE);
                if (fileInputRef.current) {
                    fileInputRef.current.value = ''; // Clear the selected file
                }
            };

            // Handle background image upload
            const handleBackgroundUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setBackgroundStyle({
                            backgroundImage: `url(${reader.result})`,
                            backgroundSize: 'cover',
                            backgroundPosition: 'center',
                            backgroundRepeat: 'no-repeat',
                            backgroundColor: 'transparent',
                            boxShadow: 'inset 0 0 50px rgba(0,0,0,0.5)'
                        });
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Function to clear the background image and revert to default gradient
            const clearBackground = () => {
                setBackgroundStyle({
                    backgroundImage: DEFAULT_BACKGROUND_STYLE.backgroundImage,
                    backgroundSize: DEFAULT_BACKGROUND_STYLE.backgroundSize,
                    backgroundPosition: DEFAULT_BACKGROUND_STYLE.backgroundPosition,
                    backgroundRepeat: DEFAULT_BACKGROUND_STYLE.backgroundRepeat,
                    backgroundColor: DEFAULT_BACKGROUND_STYLE.backgroundColor,
                    boxShadow: DEFAULT_BACKGROUND_STYLE.boxShadow
                });
                if (backgroundFileInputRef.current) {
                    backgroundFileInputRef.current.value = ''; // Clear the selected file
                }
            };

            // Function to process and set custom SVG, adjusting fill for consistency
            const processAndSetSvg = (svgString, setSvgState) => {
                // Remove XML declaration, DOCTYPE, and metadata for cleaner embedding
                let cleanedSvg = svgString
                    .replace(/<\?xml[^>]*\?>/g, '')
                    .replace(/<!DOCTYPE[^>]*>/g, '')
                    .replace(/<metadata>[\s\S]*?<\/metadata>/g, '');

                // Ensure the main <svg> tag has appropriate sizing and aspect ratio
                // Also, attempt to change fill to "currentColor" so it respects parent text color
                cleanedSvg = cleanedSvg.replace(/<svg([^>]*)>/, (match, p1) => {
                    let newAttrs = p1;
                    if (!p1.includes('width=')) newAttrs += ' width="100%"';
                    if (!p1.includes('height=')) newAttrs += ' height="100%"';
                    if (!p1.includes('preserveAspectRatio=')) newAttrs += ' preserveAspectRatio="xMidYMid meet"';
                    // Replace specific fill colors (like #000000) with currentColor
                    cleanedSvg = cleanedSvg.replace(/fill="[^"]*"/g, 'fill="currentColor"');
                    return `<svg${newAttrs}>`;
                });

                setSvgState(cleanedSvg);
            };

            // Handle custom badge 1 upload
            const handleBadge1Upload = (event) => {
                const file = event.target.files[0];
                if (file && file.type === 'image/svg+xml') {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        processAndSetSvg(reader.result, setCustomBadge1Svg);
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please upload a valid SVG file for Badge 1.');
                    if (event.target) event.target.value = ''; // Clear file input
                }
            };

            // Handle custom badge 2 upload
            const handleBadge2Upload = (event) => {
                const file = event.target.files[0];
                if (file && file.type === 'image/svg+xml') {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        processAndSetSvg(reader.result, setCustomBadge2Svg);
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please upload a valid SVG file for Badge 2.');
                    if (event.target) event.target.value = ''; // Clear file input
                }
            };

            // Function to clear custom badge 1
            const clearBadge1 = () => {
                setCustomBadge1Svg(null);
                if (badge1FileInputRef.current) badge1FileInputRef.current.value = '';
            };

            // Function to clear custom badge 2
            const clearBadge2 = () => {
                setCustomBadge2Svg(null);
                if (badge2FileInputRef.current) badge2FileInputRef.current.value = '';
            };

            // Handle equipment checkbox changes (max 3)
            const handleEquipmentChange = (e) => {
                const value = e.target.value;
                const isChecked = e.target.checked;

                setSelectedEquipment(prev => {
                    if (isChecked) {
                        if (prev.length < 3) {
                            return [...prev, value];
                        } else {
                            // If already 3, prevent checking more
                            e.target.checked = false; // Uncheck the box if limit reached
                            return prev;
                        }
                    } else {
                        return prev.filter(item => item !== value);
                    }
                });
            };

            const downloadIdCard = () => {
                if (idCardRef.current) {
                    if (window.html2canvas) {
                        window.html2canvas(idCardRef.current, {
                            scale: 2,
                            useCORS: true,
                            logging: true,
                        }).then(canvas => {
                            const link = document.createElement('a');
                            link.download = 'phasmo-id-card.png';
                            link.href = canvas.toDataURL('image/png');
                            link.click();
                        }).catch(error => {
                            console.error("Error generating ID card image:", error);
                            alert("Failed to generate ID card image. Please try again.");
                        });
                    } else {
                        console.error("html2canvas is not loaded. Cannot download ID card.");
                        alert("Image download feature is not ready. Please try again in a moment.");
                    }
                }
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-100 p-4 flex flex-col items-center justify-center gap-8 w-full">
                    {/* Input Form Section - Horizontal Bar at the Top */}
                    <div className="w-full bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8">
                        <h1 className="text-3xl font-bold text-red-500 mb-6 text-center">Create Your Phasmo ID</h1>

                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                            <div className="min-w-0">
                                <label htmlFor="agentName" className="block text-sm font-medium text-gray-300 mb-1">Agent Name</label>
                                <input type="text" id="agentName" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={agentName} onChange={(e) => setAgentName(e.target.value)} placeholder="e.g., John Doe" />
                            </div>
                            <div className="min-w-0">
                                <label htmlFor="rank" className="block text-sm font-medium text-gray-300 mb-1">Main Title</label>
                                <input type="text" id="rank" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={rank} onChange={(e) => setRank(e.target.value)} placeholder="e.g., Investigator" />
                            </div>
                            <div className="min-w-0">
                                <label htmlFor="prestige" className="block text-sm font-medium text-gray-300 mb-1">Prestige</label>
                                <input type="number" id="prestige" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={prestige} onChange={(e) => setPrestige(parseInt(e.target.value) || 0)} placeholder="e.g., 1" min="0" />
                            </div>
                            <div className="min-w-0">
                                <label htmlFor="actualLevel" className="block text-sm font-medium text-gray-300 mb-1">Level</label>
                                <input type="number" id="actualLevel" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400" value={actualLevel} onChange={(e) => setActualLevel(parseInt(e.target.value) || 0)} placeholder="e.g., 97" min="0" />
                            </div>

                            {/* New Category Selection Dropdown */}
                            <div className="min-w-0 col-span-full sm:col-span-2 md:col-span-3 lg:col-span-1">
                                <label htmlFor="categorySelect" className="block text-sm font-medium text-gray-300 mb-1">Choose Detail Type</label>
                                <select
                                    id="categorySelect"
                                    className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white"
                                    value={selectedCategory}
                                    onChange={(e) => setSelectedCategory(e.target.value)}
                                >
                                    <option value="equipment">Preferred Gear</option>
                                    <option value="specialization">Specialization</option>
                                    <option value="teamName">Team Name</option>
                                </select>
                            </div>

                            {/* Conditional Input Fields - Reverted centering changes */}
                            {selectedCategory === 'equipment' && (
                                <div className="min-w-0 col-span-full">
                                    <label className="block text-sm font-medium text-gray-300 mb-2">Select Preferred Gear (Max 3)</label>
                                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 max-h-48 overflow-y-auto p-2 rounded-lg bg-gray-700 border border-gray-600 w-full">
                                        {EQUIPMENT_LIST.map(item => (
                                            <div key={item} className="flex items-center">
                                                <input
                                                    type="checkbox"
                                                    id={`gear-${item}`}
                                                    value={item}
                                                    checked={selectedEquipment.includes(item)}
                                                    onChange={handleEquipmentChange}
                                                    className="form-checkbox h-4 w-4 text-red-600 transition duration-150 ease-in-out rounded-md border-gray-500 bg-gray-800"
                                                />
                                                <label htmlFor={`gear-${item}`} className="ml-2 text-sm text-gray-300">{item}</label>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {selectedCategory === 'specialization' && (
                                <div className="min-w-0 col-span-full">
                                    <label htmlFor="specializationSelect" className="block text-sm font-medium text-gray-300 mb-1">Select Specialization</label>
                                    <select
                                        id="specializationSelect"
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white"
                                        value={selectedSpecialization}
                                        onChange={(e) => setSelectedSpecialization(e.target.value)}
                                    >
                                        {SPECIALIZATION_LIST.map(item => (
                                            <option key={item} value={item}>{item}</option>
                                        ))}
                                    </select>
                                </div>
                            )}

                            {selectedCategory === 'teamName' && (
                                <div className="min-w-0 col-span-full">
                                    <label htmlFor="teamNameInput" className="block text-sm font-medium text-gray-300 mb-1">Team Name</label>
                                    <input
                                        type="text"
                                        id="teamNameInput"
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white placeholder-gray-400"
                                        value={teamNameInput}
                                        onChange={(e) => setTeamNameInput(e.target.value)}
                                        placeholder="e.g., Ghost Hunters"
                                    />
                                </div>
                            )}

                            {/* Container for Profile Image and Background Image sections to be on the same row */}
                            <div className="col-span-full grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* Image Upload and Clear Button for Profile Photo */}
                                <div className="min-w-0">
                                    <label htmlFor="profileImageUpload" className="block text-sm font-medium text-gray-300 mb-1">Upload Profile Image</label>
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearProfileImage}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Photo
                                        </button>
                                        <input
                                            type="file"
                                            id="profileImageUpload"
                                            accept="image/*"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleImageUpload}
                                            ref={fileInputRef} // Attach ref here
                                        />
                                    </div>
                                </div>

                                {/* Image Upload and Clear Button for Background */}
                                <div className="min-w-0">
                                    <label htmlFor="backgroundUpload" className="block text-sm font-medium text-gray-300 mb-1">Choose Background</label>
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearBackground}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Background
                                        </button>
                                        <input
                                            type="file"
                                            id="backgroundUpload"
                                            accept="image/*"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleBackgroundUpload}
                                            ref={backgroundFileInputRef} // Attach ref here
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Custom Badge 1 Upload */}
                            <div className="col-span-full grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="min-w-0">
                                    <label htmlFor="badge1Upload" className="block text-sm font-medium text-gray-300 mb-1">Upload Badge 1 (SVG only)</label>
                                    <p className="text-xs text-gray-400 mb-2">
                                        Need to convert an image to SVG? Try <a href="https://picsvg.com/" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:underline">picsvg.com</a>
                                    </p>
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearBadge1}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Badge 1
                                        </button>
                                        <input
                                            type="file"
                                            id="badge1Upload"
                                            accept="image/svg+xml"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleBadge1Upload}
                                            ref={badge1FileInputRef}
                                        />
                                    </div>
                                </div>

                                {/* Custom Badge 2 Upload */}
                                <div className="min-w-0">
                                    <label htmlFor="badge2Upload" className="block text-sm font-medium text-gray-300 mb-1">Upload Badge 2 (SVG only)</label>
                                    <p className="text-xs text-gray-400 mb-2">
                                        Need to convert an image to SVG? Try <a href="https://picsvg.com/" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:underline">picsvg.com</a>
                                    </p>
                                    <div className="flex items-center space-x-2">
                                        <button
                                            onClick={clearBadge2}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold rounded-full border border-gray-500 transition duration-300 ease-in-out"
                                        >
                                            Clear Badge 2
                                        </button>
                                        <input
                                            type="file"
                                            id="badge2Upload"
                                            accept="image/svg+xml"
                                            className="w-full text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 cursor-pointer"
                                            onChange={handleBadge2Upload}
                                            ref={badge2FileInputRef}
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* New Color Pickers */}
                            <div className="col-span-full grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="min-w-0">
                                    <label htmlFor="accentColor" className="block text-sm font-medium text-gray-300 mb-1">Accent Color (Text & Border)</label>
                                    <input
                                        type="color"
                                        id="accentColor"
                                        className="w-full h-10 p-1 border border-gray-600 rounded-lg cursor-pointer"
                                        value={accentColor}
                                        onChange={(e) => setAccentColor(e.target.value)}
                                    />
                                </div>
                                <div className="min-w-0">
                                    <label htmlFor="labelColor" className="block text-sm font-medium text-gray-300 mb-1">Label Color (NAME, LEVEL, etc.)</label>
                                    <input
                                        type="color"
                                        id="labelColor"
                                        className="w-full h-10 p-1 border border-gray-600 rounded-lg cursor-pointer"
                                        value={labelColor}
                                        onChange={(e) => setLabelColor(e.target.value)}
                                    />
                                </div>
                            </div>


                            <div className="col-span-full min-w-0">
                                <button onClick={downloadIdCard} className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                                    Download ID Card
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* ID Card Display Section - centered below the form */}
                    <div className="flex-shrink-0 mx-auto w-full flex justify-center">
                        <div
                            ref={idCardRef}
                            className="relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 rounded-xl shadow-2xl overflow-hidden border-2"
                            style={{
                                width: 'min(100%, 1000px)', /* Responsive width, max 1000px */
                                minWidth: '500px', /* Minimum width for visibility */
                                aspectRatio: '1000 / 553', /* Maintain aspect ratio */
                                ...backgroundStyle, /* Apply dynamic background style */
                                borderColor: accentColor /* Apply accent color to border */
                            }}
                        >
                            {/* Top Header: PARANORMAL INVESTIGATOR */}
                            <div className="absolute top-0 left-0 right-0 text-white text-center py-4 px-6 rounded-t-xl" style={{ height: '70px', backgroundColor: accentColor }}>
                                <h2 className="text-4xl font-extrabold uppercase tracking-widest leading-none" style={{ textShadow: '2px 2px 4px rgba(0,0,0,0.5)' }}>
                                    {rank}
                                </h2>
                            </div>

                            {/* Main Content Area - Now using absolute positioning for sub-sections */}
                            <div className="absolute top-[70px] left-0 right-0 bottom-0">
                                {/* Profile Image Container */}
                                <div className="absolute w-[250px] h-[350px] rounded-xl overflow-hidden border-4 border-gray-400 bg-gray-600 shadow-lg flex-shrink-0"
                                    style={{ left: '20px', top: '20px', borderRadius: '15px' }}>
                                    <img
                                        src={profileImage}
                                        alt="Profile"
                                        className="w-full h-full object-cover"
                                        onError={(e) => {
                                            e.target.onerror = null;
                                            e.target.src = DEFAULT_PROFILE_IMAGE; // Use default placeholder on error
                                        }}
                                    />
                                </div>

                                {/* Name, Level, and Dynamic Text Fields */}
                                <div className="absolute flex flex-col justify-start items-start h-full pt-5 pl-4" style={{ left: '300px', top: '20px' }}>
                                    <p className="text-xl font-bold uppercase mb-1" style={{ color: labelColor }}>NAME</p>
                                    <h3 className="text-6xl font-extrabold uppercase tracking-wide leading-tight" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor }}>
                                        {agentName}
                                    </h3>
                                    <p className="text-xl font-bold uppercase mt-4 mb-1" style={{ color: labelColor }}>LEVEL</p>
                                    <h3 className="text-5xl font-extrabold uppercase tracking-wide leading-tight" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor }}>
                                        {`${toRoman(prestige)}-${actualLevel}`}
                                    </h3>

                                    {/* Dynamic section for Preferred Gear, Specialization, or Team Name */}
                                    <div className="mt-8 space-y-4"> {/* Increased space-y for better vertical separation */}
                                        {selectedCategory === 'equipment' && (
                                            <p className="flex flex-col items-start"> {/* Use flex-col to stack label and content */}
                                                <span className="text-xl font-bold uppercase mr-2" style={{ color: labelColor }}>Preferred Gear:</span>
                                                <span className="text-2xl font-extrabold uppercase tracking-wide leading-tight overflow-x-auto whitespace-nowrap max-w-full" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor }}>
                                                    {selectedEquipment.join(', ')}
                                                </span>
                                            </p>
                                        )}
                                        {selectedCategory === 'specialization' && (
                                            <p className="flex flex-col items-start"> {/* Use flex-col to stack label and content */}
                                                <span className="text-xl font-bold uppercase mr-2" style={{ color: labelColor }}>Specialization:</span>
                                                <span className="text-2xl font-extrabold uppercase tracking-wide leading-tight overflow-x-auto whitespace-nowrap max-w-full" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor }}>
                                                    {selectedSpecialization}
                                                </span>
                                            </p>
                                        )}
                                        {selectedCategory === 'teamName' && (
                                            <p className="flex flex-col items-start"> {/* Use flex-col to stack label and content */}
                                                <span className="text-xl font-bold uppercase mr-2" style={{ color: labelColor }}>Team Name:</span>
                                                <span className="text-2xl font-extrabold uppercase tracking-wide leading-tight overflow-x-auto whitespace-nowrap max-w-full" style={{ textShadow: '3px 3px 6px rgba(0,0,0,0.7)', color: accentColor }}>
                                                    {teamNameInput}
                                                </span>
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* Badges */}
                                <div className="absolute flex flex-row items-center justify-start space-x-8" style={{ right: '80px', top: '150px' }}>
                                    {/* Badge 1 */}
                                    <div className="w-28 h-28 rounded-full flex items-center justify-center shadow-xl aspect-square">
                                        {customBadge1Svg ? (
                                            <div className="w-full h-full text-white" dangerouslySetInnerHTML={{ __html: customBadge1Svg }} />
                                        ) : (
                                            // Default Candle SVG Icon
                                            <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                                                width="142.000000pt" height="142.000000pt" viewBox="0 0 142.000000 142.000000"
                                                preserveAspectRatio="xMidYMid meet" className="w-full h-full p-4 text-white">
                                                <g transform="translate(0.000000,142.000000) scale(0.100000,-0.100000)"
                                                fill="currentColor" stroke="none">
                                                <path d="M665 1385 c-16 -9 -41 -22 -55 -31 -18 -11 -40 -13 -83 -8 -71 8
                                                -110 -7 -137 -51 -25 -41 -54 -60 -104 -69 -44 -8 -96 -54 -96 -84 0 -41 -31
                                                -92 -70 -117 -51 -32 -63 -64 -55 -137 6 -51 4 -63 -19 -102 -34 -59 -34 -113
                                                0 -163 23 -34 25 -44 20 -99 -8 -77 3 -107 53 -141 41 -29 71 -78 71 -116 0
                                                -31 48 -75 90 -83 59 -11 81 -26 113 -77 28 -43 77 -60 131 -46 37 9 50 8 75
                                                -5 17 -9 45 -23 61 -32 34 -18 101 -12 120 11 20 24 76 37 114 26 56 -15 101
                                                2 133 50 29 44 59 63 115 73 40 7 75 42 84 85 10 51 34 91 65 110 52 32 63 56
                                                61 138 -2 63 1 80 23 117 32 54 32 86 0 140 -22 37 -25 54 -23 117 2 77 -11
                                                114 -44 125 -27 8 -78 73 -78 99 0 57 -61 115 -121 115 -13 0 -43 23 -79 60
                                                l-57 60 -79 -3 c-68 -2 -83 1 -111 21 -42 30 -81 35 -118 17z m247 -108 c200
                                                -73 350 -246 392 -449 20 -97 20 -149 0 -246 -43 -212 -199 -387 -409 -458
                                                -67 -22 -97 -27 -185 -27 -174 0 -308 55 -430 176 -114 112 -169 237 -178 400
                                                -9 183 46 326 178 458 80 81 179 139 282 165 85 22 267 12 350 -19z"/>
                                                <path d="M565 1276 c-188 -46 -350 -195 -415 -379 -31 -87 -38 -249 -15 -337
                                                51 -197 203 -358 400 -421 90 -29 240 -31 330 -5 212 63 371 230 419 443 69
                                                306 -123 618 -431 698 -68 18 -218 18 -288 1z m253 -40 c183 -40 345 -183 407
                                                -361 23 -66 31 -212 15 -284 -21 -99 -75 -197 -149 -271 -207 -207 -531 -215
                                                -746 -18 -121 110 -180 243 -179 403 1 153 50 269 159 381 133 134 312 189
                                                493 150z"/>
                                                </g>
                                            </svg>
                                        )}
                                    </div>

                                    {/* Badge 2 */}
                                    <div className="w-28 h-28 rounded-full flex items-center justify-center shadow-xl aspect-square">
                                        {customBadge2Svg ? (
                                            <div className="w-full h-full text-white" dangerouslySetInnerHTML={{ __html: customBadge2Svg }} />
                                        ) : (
                                            // Default Crucifix SVG Icon
                                            <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                                                width="142.000000pt" height="142.000000pt" viewBox="0 0 142.000000 142.000000"
                                                preserveAspectRatio="xMidYMid meet" className="w-full h-full p-4 text-white">
                                                <g transform="translate(0.000000,142.000000) scale(0.100000,-0.100000)"
                                                fill="currentColor" stroke="none">
                                                <path d="M655 1384 c-85 -47 -84 -47 -131 -35 -58 15 -97 -1 -147 -62 -28 -35
                                                -47 -48 -75 -53 -75 -13 -122 -60 -122 -121 0 -18 -17 -42 -60 -83 l-61 -58 3
                                                -79 c3 -68 0 -82 -20 -110 -38 -53 -39 -91 -4 -157 28 -52 30 -62 25 -124 -5
                                                -67 -5 -69 27 -98 75 -68 90 -87 90 -113 0 -34 34 -89 62 -100 13 -4 43 -15
                                                68 -22 32 -10 51 -24 70 -53 39 -57 63 -67 141 -60 60 6 71 4 111 -20 57 -33
                                                98 -33 154 0 40 24 52 26 104 20 72 -8 100 4 153 68 31 37 46 47 80 53 48 7
                                                107 58 107 93 0 34 18 62 73 112 l52 46 -2 78 c-2 67 1 84 22 120 33 57 33
                                                110 -1 155 -24 31 -25 39 -19 101 7 80 -7 115 -60 148 -39 24 -65 66 -65 104
                                                0 37 -45 84 -88 92 -56 10 -87 30 -111 69 -29 50 -80 71 -136 55 -43 -12 -63
                                                -7 -135 35 -33 19 -68 19 -105 -1z m81 -39 c18 -13 15 -14 -28 -15 -53 0 -60
                                                6 -25 20 30 12 31 12 53 -5z m-226 -40 c0 -4 -67 -35 -77 -35 -2 0 1 9 7 20 7
                                                13 21 20 40 20 17 0 30 -2 30 -5z m461 -5 c10 -6 19 -15 19 -20 0 -13 -8 -9 -35
                                                17 -19 19 -35 38 -35 42 0 15 21 8 45 -17z m-139 -21 c123 -26 265 -115
                                                337 -212 187 -250 167 -562 -49 -777 -120 -120 -252 -174 -420 -173 -241 2
                                                -450 148 -542 378 -30 76 -32 87 -32 210 0 120 2 135 28 200 77 188 231 325
                                                414 370 71 17 194 19 264 4z m333 -114 c14 -13 25 -32 25 -42 0 -13 -8 -9 -35
                                                17 -19 19 -35 38 -35 42 0 15 21 8 45 -17z m-900 -15 c-17 -17 -31 -26 -33
                                                -20 -5 15 27 50 46 50 11 0 7 -9 -13 -30z m-132 -200 c-17 -43 -33 -53 -33
                                                -20 0 17 32 60 44 60 3 0 -3 -18 -11 -40z m1177 -1 c13 -30 7 -51 -9 -33 -4 5
                                                -13 23 -19 41 -8 26 -8 31 3 27 7 -3 19 -19 25 -35z m-1230 -250 c0 -54 -14
                                                -59 -25 -8 -6 25 6 59 21 59 2 0 4 -23 4 -51z m1280 -1 c0 -16 -4 -28 -10 -28
                                                -5 0 -10 19 -10 43 0 31 3 38 10 27 5 -8 10 -27 10 -42z m-40 -223 c0 -17 -49
                                                -75 -50 -58 0 7 7 28 17 47 16 34 33 40 33 11z m-1190 -15 c7 -17 10 -33 8
                                                -36 -9 -9 -38 27 -38 47 0 29 16 23 30 -11z m145 -228 c-22 -5 -45 16 -45 41
                                                0 19 2 18 31 -9 24 -23 27 -30 14 -32z m899 21 c-22 -29 -44 -41 -44 -23 0 14
                                                51 62 58 55 3 -3 -3 -17 -14 -32z m-701 -130 c9 -3 17 -9 17 -14 0 -15 -37
                                                -10 -54 7 -21 20 -20 28 2 19 9 -4 25 -10 35 -12z m517 8 c0 -12 -40 -41 -57
                                                -41 -22 0 -14 19 15 34 32 18 42 19 42 7z m-242 -63 c-6 -16 -32 -22 -64 -14
                                                -40 10 -27 26 22 26 32 0 44 -4 42 -12z"/>
                                                <path d="M572 1230 c-104 -27 -167 -64 -247 -145 -82 -82 -118 -144 -145 -251
                                                -23 -89 -25 -154 -6 -239 65 -306 360 -491 665 -420 186 44 347 203 395 391
                                                47 184 -7 387 -138 518 -140 140 -337 195 -524 146z m248 -31 c173 -40 331
                                                -192 376 -363 22 -83 18 -219 -10 -297 -126 -358 -592 -457 -849 -180 -116
                                                126 -163 306 -122 466 47 178 196 327 370 370 63 16 176 18 235 4z"/>
                                                </g>
                                            </svg>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
